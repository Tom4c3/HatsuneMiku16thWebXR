<html>
<head>
    <!--babylon.jsの読み込み-->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <!--実際の処理の実装-->
    <script type="text/javascript">
        let canvas; //canvas要素 (描画領域)
        let engine; //Babylon.jsによる描画機能
        let scene; //仮想3D空間

        window.onload = function () {
            canvas = document.getElementById("renderCanvas");
            engine = new BABYLON.Engine(canvas, true);
            createScene();
            addObjects();
            initializeXR();
            engine.runRenderLoop(function () {
                if (scene && scene.activeCamera) {
                    scene.render();
                }
            });
        }

        function createScene() {
            scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color3.Black();
            let light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, -0.5));
            let camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2, 3, new BABYLON.Vector3(0, 0, 0));
            camera.attachControl(canvas, true);
        }

        async function initializeXR() {
            let xr = await scene.createDefaultXRExperienceAsync(
                {
                    uiOptions: {
                        sessionMode: 'immersive-ar'
                    }
                });
            if (!xr.baseExperience) { }
            else {
                xr.baseExperience.featuresManager.enableFeature(BABYLON.WebXRFeatureName.HAND_TRACKING, "latest", {
                    xrInput: xr.input
                });
                xr.baseExperience.sessionManager.onXRFrameObservable.addOnce(() => {
                    xr.baseExperience.camera.position = new BABYLON.Vector3(0, scene.activeCamera.position.y, -2);
                });
            }
        }

        function addObjects() {
            // ここで地面、箱、八面体の作成部分を削除しました。

            BABYLON.SceneLoader.LoadAssetContainer(
                "https://cdn.glitch.global/16f149ed-72a8-405c-ba82-773060c0d10c/Miku16th_v0.5.glb?v=1693390473446",
                "",
                scene,
                function (container) {
                    let glbMesh = container.meshes[1];
                    glbMesh.scaling = new BABYLON.Vector3(10, 10, 10);
                    glbMesh.rotation = new BABYLON.Vector3(0, Math.PI, 0);
                    let dragBehavior2 = new BABYLON.SixDofDragBehavior();
                    dragBehavior2.allowMultiPointer = false;
                    dragBehavior2.rotateWithMotionController = false;
                    glbMesh.addBehavior(dragBehavior2);
                    scene.addMesh(glbMesh);
                }
            );
        }
    </script>
</head>
<body>
    <canvas id="renderCanvas" style="width: 100%; height: 100%;"></canvas>
</body>
</html>
